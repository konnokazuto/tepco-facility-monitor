---
description: 
globs: 
alwaysApply: true
---
# 東京電力 屋外常設物管理システム 技術スタック

## 1. 画像取得システム
### 1.1 ドローン撮影
- **機器**: DJI M300 RTK + Zenmuse P1
- **制御ソフト**: DJI SDK

### 1.2 画像前処理
- **オルソモザイク化**: Pix4D
- **基本処理**: OpenCV + PIL

## 2. 申請情報処理システム
### 2.1 OCR処理
- **OCRエンジン**: Tesseract OCR + layoutparser
- **PDF構造解析**: pdfplumber / Adobe PDF Extract API

### 2.2 データ構造化
- **構造化処理**: pandas / spaCy（エンティティ抽出）
- **テキスト正規化**: LangChain / llama-index
- **埋め込み生成**: Sentence-BERT / OpenAI ada / localモデル（e5など）

## 3. 画像分析システム
### 3.1 差分検出処理
- **移動物検知**: YOLOv11（人・車などの除外）
- **色彩変化検知**: k-meansクラスタリング / 色ヒストグラム差分
- **ノイズ除去**: 解像度・彩度・サイズ・位置などのフィルター

### 3.2 差分分析アルゴリズム
- **構造的類似性**: SSIM（Structural Similarity Index Measure）
- **画素差分**: XOR / cv2.absdiff + 閾値処理（binary化）
- **特徴点マッチング**: Feature Matching（ORB/SIFT）
- **セグメンテーション**: DeepLabV3+

### 3.3 可視化処理
- **ヒートマップ**: OpenCV + Matplotlib / seaborn
- **セグメント表示**: オーバーレイレンダリング技術

## 4. データベースシステム
### 4.1 画像データ管理
- **保存形式**: タイル化画像 + メタデータ
- **画像DB**: PostgreSQL（バイナリ型）/ 専用ファイルシステム

### 4.2 申請情報管理
- **RDBMS**: SQLite / PostgreSQL
- **履歴管理**: バージョン管理テーブル

### 4.3 検索エンジン
- **全文検索**: Whoosh / Elasticsearch
- **ベクトル検索**: FAISS / Qdrant

## 5. AIシステム
### 5.1 物体検出
- **検出モデル**: YOLOv11
- **除外対象**: 人、車両、一時的設置物

### 5.2 大規模言語モデル
- **ローカルLLM**: llama3 8B / mistral / OpenCALM
- **ユースケース**: 申請内容の要約、不整合検出、突合処理

## 6. フロントエンドシステム
### 6.1 Webフレームワーク
- **UI基盤**: React
- **状態管理**: Zustand
- **UIコンポーネント**: shadcn/ui

### 6.2 地図・画像表示
- **地図エンジン**: Leaflet.js
- **キャンバス操作**: Fabric.js
- **画像比較**: Image-Compare-Viewer（スライダー比較）

### 6.3 フォーム管理
- **フォームライブラリ**: React Hook Form
- **バリデーション**: zod

## 7. セキュリティシステム
### 7.1 認証
- **認証プロトコル**: OAuth2 / OpenID Connect
- **MFA**: ワンタイムパスワード（必要に応じて）

### 7.2 監査
- **操作ログ**: audit log
- **不正検知**: anomaly detection (PyODなど)

## 8. 連携システム
### 8.1 地図連携
- **マップ表示**: Leaflet.js + DB連携
- **位置情報管理**: GeoJSON / PostGIS

### 8.2 LLM連携
- **クエリエンジン**: retrieval QA
- **突合処理**: LLM照合 / ルールベースマッチング（属性一致率）

## 9. 開発・運用環境
### 9.1 開発環境
- **フロントエンド**: TypeScript + Vite
- **バックエンド**: Python (FastAPI / Django)
- **コンテナ化**: Docker

### 9.2 CI/CD
- **ビルド・テスト自動化**: GitHub Actions / Jenkins
- **デプロイ**: Kubernetes / Docker Compose

### 9.3 モニタリング
- **パフォーマンス監視**: Prometheus / Grafana
- **エラー追跡**: Sentry

## 注意事項
- 一部技術選定は検討中で、プロトタイピングの結果により変更の可能性あり
- 特に突合処理はPoC段階で最適なアプローチを決定予定
- オンプレミス環境を前提とした構成のため、クラウドサービスへの依存は最小限に抑える